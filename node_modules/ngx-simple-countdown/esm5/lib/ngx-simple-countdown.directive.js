/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, Input, ElementRef } from '@angular/core';
import { interval, ReplaySubject } from 'rxjs';
import { tap, takeUntil, filter } from 'rxjs/operators';
var NgxSimpleCountdownDirective = /** @class */ (function () {
    function NgxSimpleCountdownDirective(elementRef) {
        this.elementRef = elementRef;
        this.language = 'en';
        this.reactive = true;
        this.endMessage = 'countdown finish';
        this.hideUnit = '';
        this.styles = 'font-size:20px;color:#FFF;background-color:#000;padding:10px 5px;font-weight:bold;min-width:40px;text-align:center;';
    }
    /**
     * @return {?}
     */
    NgxSimpleCountdownDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.getDateNow();
        this.setLanguage(this.language);
        this.initSimpleCountdown();
    };
    /**
     * @return {?}
     */
    NgxSimpleCountdownDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () { };
    /**
     * @private
     * @return {?}
     */
    NgxSimpleCountdownDirective.prototype.initSimpleCountdown = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.totalSecondes = this.dateTo - this.dateNow;
        this.countdownResult = this.updateSimpleCountdown(this.totalSecondes);
        this.createHTML();
        this.interval$ = interval(1000).pipe(takeUntil(this.componentDestroyed(this)), filter((/**
         * @param {?} _
         * @return {?}
         */
        function (_) { return _this.reactive && _this.totalSecondes > 0; })), tap((/**
         * @param {?} _
         * @return {?}
         */
        function (_) { return _this.totalSecondes--; })), tap((/**
         * @param {?} _
         * @return {?}
         */
        function (_) {
            return (_this.countdownResult = _this.updateSimpleCountdown(_this.totalSecondes));
        })), tap((/**
         * @param {?} _
         * @return {?}
         */
        function (_) { return _this.createHTML(); })));
        this.interval$.subscribe();
    };
    /**
     * @private
     * @return {?}
     */
    NgxSimpleCountdownDirective.prototype.createHTML = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var o = '';
        if (this.totalSecondes > 0) {
            o = '<div style="display:flex;">';
            if (this.isContent('d')) {
                if (this.countdownResult.day > 0) {
                    o += "<div style=\"" + this.styles + "\">\n          " + this.countdownResult.day + this.keywords.day + "\n          </div>";
                }
            }
            if (this.isContent('h')) {
                if (this.countdownResult.hours > 0 || this.countdownResult.day > 0) {
                    o += "<div style=\"" + this.styles + "\">\n          " + this.countdownResult.hours + this.keywords.hours + "\n        </div>";
                }
            }
            if (this.isContent('m')) {
                if ((this.countdownResult.minutes > 0 ||
                    this.countdownResult.hours > 0 ||
                    this.countdownResult.day > 0) &&
                    this.reactive) {
                    o += "<div style=\"" + this.styles + "\">\n          " + this.countdownResult.minutes + this.keywords.minutes + "\n        </div>";
                }
            }
            if (this.isContent('s')) {
                if ((this.countdownResult.seconds > 0 ||
                    this.countdownResult.minutes > 0 ||
                    this.countdownResult.hours > 0 ||
                    this.countdownResult.day > 0) &&
                    this.reactive) {
                    o += "<div style=\"" + this.styles + "\">\n          " + this.countdownResult.seconds + this.keywords.seconds + "\n        </div>";
                }
                o += '</div>';
            }
        }
        else {
            if (this.endMessage !== '') {
                o += "<div style=\"" + this.styles + "\">" + this.endMessage + "</div>";
            }
        }
        this.elementRef.nativeElement.innerHTML = o;
    };
    /**
     * @private
     * @param {?} unit
     * @return {?}
     */
    NgxSimpleCountdownDirective.prototype.isContent = /**
     * @private
     * @param {?} unit
     * @return {?}
     */
    function (unit) {
        return !this.hideUnit.includes(unit);
    };
    /**
     * @private
     * @param {?} secondes
     * @return {?}
     */
    NgxSimpleCountdownDirective.prototype.updateSimpleCountdown = /**
     * @private
     * @param {?} secondes
     * @return {?}
     */
    function (secondes) {
        /** @type {?} */
        var Seconds = Math.floor((secondes / 1) % 60);
        /** @type {?} */
        var Minutes = Math.floor((secondes / 1 / 60) % 60);
        /** @type {?} */
        var Hours = Math.floor((secondes / (1 * 60 * 60)) % 24);
        /** @type {?} */
        var Day = Math.floor(secondes / (1 * 60 * 60 * 24));
        return {
            day: Day,
            hours: Hours,
            minutes: Minutes,
            seconds: Seconds
        };
    };
    /**
     * @private
     * @return {?}
     */
    NgxSimpleCountdownDirective.prototype.getDateNow = /**
     * @private
     * @return {?}
     */
    function () {
        this.dateNow = Math.floor(Date.now() / 1000);
    };
    /**
     * @private
     * @param {?} language
     * @return {?}
     */
    NgxSimpleCountdownDirective.prototype.setLanguage = /**
     * @private
     * @param {?} language
     * @return {?}
     */
    function (language) {
        if (language === 'fr') {
            this.keywords = {
                seconds: 's',
                minutes: 'm',
                hours: 'h',
                day: 'j'
            };
        }
        else if (language === 'de') {
            this.keywords = {
                seconds: 'z',
                minutes: 'm',
                hours: 's',
                day: 't'
            };
        }
        else if (language === 'es' || language === 'pt') {
            this.keywords = {
                seconds: 's',
                minutes: 'm',
                hours: 's',
                day: 'd'
            };
        }
        else if (language === 'cs') {
            this.keywords = {
                seconds: 's',
                minutes: 'm',
                hours: 'h',
                day: 'd'
            };
        }
        else if (language === 'pl') {
            this.keywords = {
                seconds: 's',
                minutes: 'm',
                hours: 'g',
                day: 'd'
            };
        }
        else {
            this.keywords = {
                seconds: 's',
                minutes: 'm',
                hours: 'h',
                day: 'd'
            };
        }
    };
    /**
     * @private
     * @param {?} component
     * @return {?}
     */
    NgxSimpleCountdownDirective.prototype.componentDestroyed = /**
     * @private
     * @param {?} component
     * @return {?}
     */
    function (component) {
        /** @type {?} */
        var oldNgOnDestroy = component.ngOnDestroy;
        /** @type {?} */
        var destroyed$ = new ReplaySubject(1);
        component.ngOnDestroy = (/**
         * @return {?}
         */
        function () {
            oldNgOnDestroy.apply(component);
            destroyed$.next(undefined);
            destroyed$.complete();
        });
        return destroyed$;
    };
    NgxSimpleCountdownDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[simpleCountdown]'
                },] }
    ];
    /** @nocollapse */
    NgxSimpleCountdownDirective.ctorParameters = function () { return [
        { type: ElementRef }
    ]; };
    NgxSimpleCountdownDirective.propDecorators = {
        dateTo: [{ type: Input }],
        language: [{ type: Input }],
        reactive: [{ type: Input }],
        endMessage: [{ type: Input }],
        hideUnit: [{ type: Input }],
        styles: [{ type: Input }]
    };
    return NgxSimpleCountdownDirective;
}());
export { NgxSimpleCountdownDirective };
if (false) {
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.dateTo;
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.language;
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.reactive;
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.endMessage;
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.hideUnit;
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.styles;
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.keywords;
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.countdownResult;
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.dateNow;
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.totalSecondes;
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.interval$;
    /**
     * @type {?}
     * @private
     */
    NgxSimpleCountdownDirective.prototype.elementRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXNpbXBsZS1jb3VudGRvd24uZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXNpbXBsZS1jb3VudGRvd24vIiwic291cmNlcyI6WyJsaWIvbmd4LXNpbXBsZS1jb3VudGRvd24uZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQXFCLE1BQU0sZUFBZSxDQUFDO0FBRWhGLE9BQU8sRUFBRSxRQUFRLEVBQWMsYUFBYSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzNELE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXhEO0lBa0JFLHFDQUFvQixVQUFzQjtRQUF0QixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBYmpDLGFBQVEsR0FBRyxJQUFJLENBQUM7UUFDaEIsYUFBUSxHQUFHLElBQUksQ0FBQztRQUNoQixlQUFVLEdBQUcsa0JBQWtCLENBQUM7UUFDaEMsYUFBUSxHQUFHLEVBQUUsQ0FBQztRQUNkLFdBQU0sR0FDYixxSEFBcUgsQ0FBQztJQVEzRSxDQUFDOzs7O0lBRTlDLDhDQUFROzs7SUFBUjtRQUNFLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUNsQixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNoQyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztJQUM3QixDQUFDOzs7O0lBRUQsaURBQVc7OztJQUFYLGNBQWUsQ0FBQzs7Ozs7SUFFUix5REFBbUI7Ozs7SUFBM0I7UUFBQSxpQkFtQkM7UUFsQkMsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDaEQsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFD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dCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIElucHV0LCBFbGVtZW50UmVmLCBPbkRlc3Ryb3ksIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0ICogYXMgZnJvbU1vZGVsIGZyb20gJy4vbW9kZWxzJztcbmltcG9ydCB7IGludGVydmFsLCBPYnNlcnZhYmxlLCBSZXBsYXlTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyB0YXAsIHRha2VVbnRpbCwgZmlsdGVyIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbc2ltcGxlQ291bnRkb3duXSdcbn0pXG5leHBvcnQgY2xhc3MgTmd4U2ltcGxlQ291bnRkb3duRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuICBASW5wdXQoKSBkYXRlVG86IG51bWJlcjtcbiAgQElucHV0KCkgbGFuZ3VhZ2UgPSAnZW4nO1xuICBASW5wdXQoKSByZWFjdGl2ZSA9IHRydWU7XG4gIEBJbnB1dCgpIGVuZE1lc3NhZ2UgPSAnY291bnRkb3duIGZpbmlzaCc7XG4gIEBJbnB1dCgpIGhpZGVVbml0ID0gJyc7XG4gIEBJbnB1dCgpIHN0eWxlcyA9XG4gICAgJ2ZvbnQtc2l6ZToyMHB4O2NvbG9yOiNGRkY7YmFja2dyb3VuZC1jb2xvcjojMDAwO3BhZGRpbmc6MTBweCA1cHg7Zm9udC13ZWlnaHQ6Ym9sZDttaW4td2lkdGg6NDBweDt0ZXh0LWFsaWduOmNlbnRlcjsnO1xuXG4gIHB1YmxpYyBrZXl3b3JkczogZnJvbU1vZGVsLkNvdW50ZG93bktleXdvcmRzO1xuICBwdWJsaWMgY291bnRkb3duUmVzdWx0OiBmcm9tTW9kZWwuQ291bnRkb3duUmVzdWx0O1xuICBwdWJsaWMgZGF0ZU5vdzogbnVtYmVyO1xuICBwdWJsaWMgdG90YWxTZWNvbmRlczogbnVtYmVyO1xuICBwdWJsaWMgaW50ZXJ2YWwkOiBPYnNlcnZhYmxlPG51bWJlcj47XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbGVtZW50UmVmOiBFbGVtZW50UmVmKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuZ2V0RGF0ZU5vdygpO1xuICAgIHRoaXMuc2V0TGFuZ3VhZ2UodGhpcy5sYW5ndWFnZSk7XG4gICAgdGhpcy5pbml0U2ltcGxlQ291bnRkb3duKCk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHt9XG5cbiAgcHJpdmF0ZSBpbml0U2ltcGxlQ291bnRkb3duKCk6IHZvaWQge1xuICAgIHRoaXMudG90YWxTZWNvbmRlcyA9IHRoaXMuZGF0ZVRvIC0gdGhpcy5kYXRlTm93O1xuICAgIHRoaXMuY291bnRkb3duUmVzdWx0ID0gdGhpcy51cGRhdGVTaW1wbGVDb3VudGRvd24odGhpcy50b3RhbFNlY29uZGVzKTtcbiAgICB0aGlzLmNyZWF0ZUhUTUwoKTtcblxuICAgIHRoaXMuaW50ZXJ2YWwkID0gaW50ZXJ2YWwoMTAwMCkucGlwZShcbiAgICAgIHRha2VVbnRpbCh0aGlzLmNvbXBvbmVudERlc3Ryb3llZCh0aGlzKSksXG4gICAgICBmaWx0ZXIoXyA9PiB0aGlzLnJlYWN0aXZlICYmIHRoaXMudG90YWxTZWNvbmRlcyA+IDApLFxuICAgICAgdGFwKF8gPT4gdGhpcy50b3RhbFNlY29uZGVzLS0pLFxuICAgICAgdGFwKFxuICAgICAgICBfID0+XG4gICAgICAgICAgKHRoaXMuY291bnRkb3duUmVzdWx0ID0gdGhpcy51cGRhdGVTaW1wbGVDb3VudGRvd24oXG4gICAgICAgICAgICB0aGlzLnRvdGFsU2Vjb25kZXNcbiAgICAgICAgICApKVxuICAgICAgKSxcbiAgICAgIHRhcChfID0+IHRoaXMuY3JlYXRlSFRNTCgpKVxuICAgICk7XG5cbiAgICB0aGlzLmludGVydmFsJC5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlSFRNTCgpOiB2b2lkIHtcbiAgICBsZXQgbyA9ICcnO1xuXG4gICAgaWYgKHRoaXMudG90YWxTZWNvbmRlcyA+IDApIHtcbiAgICAgIG8gPSAnPGRpdiBzdHlsZT1cImRpc3BsYXk6ZmxleDtcIj4nO1xuXG4gICAgICBpZiAodGhpcy5pc0NvbnRlbnQoJ2QnKSkge1xuICAgICAgICBpZiAodGhpcy5jb3VudGRvd25SZXN1bHQuZGF5ID4gMCkge1xuICAgICAgICAgIG8gKz0gYDxkaXYgc3R5bGU9XCIke3RoaXMuc3R5bGVzfVwiPlxuICAgICAgICAgICR7dGhpcy5jb3VudGRvd25SZXN1bHQuZGF5fSR7dGhpcy5rZXl3b3Jkcy5kYXl9XG4gICAgICAgICAgPC9kaXY+YDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5pc0NvbnRlbnQoJ2gnKSkge1xuICAgICAgICBpZiAodGhpcy5jb3VudGRvd25SZXN1bHQuaG91cnMgPiAwIHx8IHRoaXMuY291bnRkb3duUmVzdWx0LmRheSA+IDApIHtcbiAgICAgICAgICBvICs9IGA8ZGl2IHN0eWxlPVwiJHt0aGlzLnN0eWxlc31cIj5cbiAgICAgICAgICAke3RoaXMuY291bnRkb3duUmVzdWx0LmhvdXJzfSR7dGhpcy5rZXl3b3Jkcy5ob3Vyc31cbiAgICAgICAgPC9kaXY+YDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5pc0NvbnRlbnQoJ20nKSkge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgKHRoaXMuY291bnRkb3duUmVzdWx0Lm1pbnV0ZXMgPiAwIHx8XG4gICAgICAgICAgICB0aGlzLmNvdW50ZG93blJlc3VsdC5ob3VycyA+IDAgfHxcbiAgICAgICAgICAgIHRoaXMuY291bnRkb3duUmVzdWx0LmRheSA+IDApICYmXG4gICAgICAgICAgdGhpcy5yZWFjdGl2ZVxuICAgICAgICApIHtcbiAgICAgICAgICBvICs9IGA8ZGl2IHN0eWxlPVwiJHt0aGlzLnN0eWxlc31cIj5cbiAgICAgICAgICAke3RoaXMuY291bnRkb3duUmVzdWx0Lm1pbnV0ZXN9JHt0aGlzLmtleXdvcmRzLm1pbnV0ZXN9XG4gICAgICAgIDwvZGl2PmA7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuaXNDb250ZW50KCdzJykpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICh0aGlzLmNvdW50ZG93blJlc3VsdC5zZWNvbmRzID4gMCB8fFxuICAgICAgICAgICAgdGhpcy5jb3VudGRvd25SZXN1bHQubWludXRlcyA+IDAgfHxcbiAgICAgICAgICAgIHRoaXMuY291bnRkb3duUmVzdWx0LmhvdXJzID4gMCB8fFxuICAgICAgICAgICAgdGhpcy5jb3VudGRvd25SZXN1bHQuZGF5ID4gMCkgJiZcbiAgICAgICAgICB0aGlzLnJlYWN0aXZlXG4gICAgICAgICkge1xuICAgICAgICAgIG8gKz0gYDxkaXYgc3R5bGU9XCIke3RoaXMuc3R5bGVzfVwiPlxuICAgICAgICAgICR7dGhpcy5jb3VudGRvd25SZXN1bHQuc2Vjb25kc30ke3RoaXMua2V5d29yZHMuc2Vjb25kc31cbiAgICAgICAgPC9kaXY+YDtcbiAgICAgICAgfVxuICAgICAgICBvICs9ICc8L2Rpdj4nO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGhpcy5lbmRNZXNzYWdlICE9PSAnJykge1xuICAgICAgICBvICs9IGA8ZGl2IHN0eWxlPVwiJHt0aGlzLnN0eWxlc31cIj4ke3RoaXMuZW5kTWVzc2FnZX08L2Rpdj5gO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmlubmVySFRNTCA9IG87XG4gIH1cblxuICBwcml2YXRlIGlzQ29udGVudCh1bml0OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gIXRoaXMuaGlkZVVuaXQuaW5jbHVkZXModW5pdCk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVNpbXBsZUNvdW50ZG93bihzZWNvbmRlczogbnVtYmVyKTogZnJvbU1vZGVsLkNvdW50ZG93blJlc3VsdCB7XG4gICAgY29uc3QgU2Vjb25kcyA9IE1hdGguZmxvb3IoKHNlY29uZGVzIC8gMSkgJSA2MCk7XG4gICAgY29uc3QgTWludXRlcyA9IE1hdGguZmxvb3IoKHNlY29uZGVzIC8gMSAvIDYwKSAlIDYwKTtcbiAgICBjb25zdCBIb3VycyA9IE1hdGguZmxvb3IoKHNlY29uZGVzIC8gKDEgKiA2MCAqIDYwKSkgJSAyNCk7XG4gICAgY29uc3QgRGF5ID0gTWF0aC5mbG9vcihzZWNvbmRlcyAvICgxICogNjAgKiA2MCAqIDI0KSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgZGF5OiBEYXksXG4gICAgICBob3VyczogSG91cnMsXG4gICAgICBtaW51dGVzOiBNaW51dGVzLFxuICAgICAgc2Vjb25kczogU2Vjb25kc1xuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGdldERhdGVOb3coKTogdm9pZCB7XG4gICAgdGhpcy5kYXRlTm93ID0gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCk7XG4gIH1cblxuICBwcml2YXRlIHNldExhbmd1YWdlKGxhbmd1YWdlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAobGFuZ3VhZ2UgPT09ICdmcicpIHtcbiAgICAgIHRoaXMua2V5d29yZHMgPSB7XG4gICAgICAgIHNlY29uZHM6ICdzJyxcbiAgICAgICAgbWludXRlczogJ20nLFxuICAgICAgICBob3VyczogJ2gnLFxuICAgICAgICBkYXk6ICdqJ1xuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKGxhbmd1YWdlID09PSAnZGUnKSB7XG4gICAgICB0aGlzLmtleXdvcmRzID0ge1xuICAgICAgICBzZWNvbmRzOiAneicsXG4gICAgICAgIG1pbnV0ZXM6ICdtJyxcbiAgICAgICAgaG91cnM6ICdzJyxcbiAgICAgICAgZGF5OiAndCdcbiAgICAgIH07XG4gICAgfSBlbHNlIGlmIChsYW5ndWFnZSA9PT0gJ2VzJyB8fCBsYW5ndWFnZSA9PT0gJ3B0Jykge1xuICAgICAgdGhpcy5rZXl3b3JkcyA9IHtcbiAgICAgICAgc2Vjb25kczogJ3MnLFxuICAgICAgICBtaW51dGVzOiAnbScsXG4gICAgICAgIGhvdXJzOiAncycsXG4gICAgICAgIGRheTogJ2QnXG4gICAgICB9O1xuICAgIH0gZWxzZSBpZiAobGFuZ3VhZ2UgPT09ICdjcycpIHtcbiAgICAgIHRoaXMua2V5d29yZHMgPSB7XG4gICAgICAgIHNlY29uZHM6ICdzJyxcbiAgICAgICAgbWludXRlczogJ20nLFxuICAgICAgICBob3VyczogJ2gnLFxuICAgICAgICBkYXk6ICdkJ1xuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKGxhbmd1YWdlID09PSAncGwnKSB7XG4gICAgICB0aGlzLmtleXdvcmRzID0ge1xuICAgICAgICBzZWNvbmRzOiAncycsXG4gICAgICAgIG1pbnV0ZXM6ICdtJyxcbiAgICAgICAgaG91cnM6ICdnJyxcbiAgICAgICAgZGF5OiAnZCdcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMua2V5d29yZHMgPSB7XG4gICAgICAgIHNlY29uZHM6ICdzJyxcbiAgICAgICAgbWludXRlczogJ20nLFxuICAgICAgICBob3VyczogJ2gnLFxuICAgICAgICBkYXk6ICdkJ1xuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNvbXBvbmVudERlc3Ryb3llZChjb21wb25lbnQ6IE9uRGVzdHJveSkge1xuICAgIGNvbnN0IG9sZE5nT25EZXN0cm95ID0gY29tcG9uZW50Lm5nT25EZXN0cm95O1xuICAgIGNvbnN0IGRlc3Ryb3llZCQgPSBuZXcgUmVwbGF5U3ViamVjdDx2b2lkPigxKTtcbiAgICBjb21wb25lbnQubmdPbkRlc3Ryb3kgPSAoKSA9PiB7XG4gICAgICBvbGROZ09uRGVzdHJveS5hcHBseShjb21wb25lbnQpO1xuICAgICAgZGVzdHJveWVkJC5uZXh0KHVuZGVmaW5lZCk7XG4gICAgICBkZXN0cm95ZWQkLmNvbXBsZXRlKCk7XG4gICAgfTtcbiAgICByZXR1cm4gZGVzdHJveWVkJDtcbiAgfVxufVxuIl19