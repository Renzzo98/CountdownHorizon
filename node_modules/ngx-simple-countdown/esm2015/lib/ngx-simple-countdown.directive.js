/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, Input, ElementRef } from '@angular/core';
import { interval, ReplaySubject } from 'rxjs';
import { tap, takeUntil, filter } from 'rxjs/operators';
export class NgxSimpleCountdownDirective {
    /**
     * @param {?} elementRef
     */
    constructor(elementRef) {
        this.elementRef = elementRef;
        this.language = 'en';
        this.reactive = true;
        this.endMessage = 'countdown finish';
        this.hideUnit = '';
        this.styles = 'font-size:20px;color:#FFF;background-color:#000;padding:10px 5px;font-weight:bold;min-width:40px;text-align:center;';
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.getDateNow();
        this.setLanguage(this.language);
        this.initSimpleCountdown();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() { }
    /**
     * @private
     * @return {?}
     */
    initSimpleCountdown() {
        this.totalSecondes = this.dateTo - this.dateNow;
        this.countdownResult = this.updateSimpleCountdown(this.totalSecondes);
        this.createHTML();
        this.interval$ = interval(1000).pipe(takeUntil(this.componentDestroyed(this)), filter((/**
         * @param {?} _
         * @return {?}
         */
        _ => this.reactive && this.totalSecondes > 0)), tap((/**
         * @param {?} _
         * @return {?}
         */
        _ => this.totalSecondes--)), tap((/**
         * @param {?} _
         * @return {?}
         */
        _ => (this.countdownResult = this.updateSimpleCountdown(this.totalSecondes)))), tap((/**
         * @param {?} _
         * @return {?}
         */
        _ => this.createHTML())));
        this.interval$.subscribe();
    }
    /**
     * @private
     * @return {?}
     */
    createHTML() {
        /** @type {?} */
        let o = '';
        if (this.totalSecondes > 0) {
            o = '<div style="display:flex;">';
            if (this.isContent('d')) {
                if (this.countdownResult.day > 0) {
                    o += `<div style="${this.styles}">
          ${this.countdownResult.day}${this.keywords.day}
          </div>`;
                }
            }
            if (this.isContent('h')) {
                if (this.countdownResult.hours > 0 || this.countdownResult.day > 0) {
                    o += `<div style="${this.styles}">
          ${this.countdownResult.hours}${this.keywords.hours}
        </div>`;
                }
            }
            if (this.isContent('m')) {
                if ((this.countdownResult.minutes > 0 ||
                    this.countdownResult.hours > 0 ||
                    this.countdownResult.day > 0) &&
                    this.reactive) {
                    o += `<div style="${this.styles}">
          ${this.countdownResult.minutes}${this.keywords.minutes}
        </div>`;
                }
            }
            if (this.isContent('s')) {
                if ((this.countdownResult.seconds > 0 ||
                    this.countdownResult.minutes > 0 ||
                    this.countdownResult.hours > 0 ||
                    this.countdownResult.day > 0) &&
                    this.reactive) {
                    o += `<div style="${this.styles}">
          ${this.countdownResult.seconds}${this.keywords.seconds}
        </div>`;
                }
                o += '</div>';
            }
        }
        else {
            if (this.endMessage !== '') {
                o += `<div style="${this.styles}">${this.endMessage}</div>`;
            }
        }
        this.elementRef.nativeElement.innerHTML = o;
    }
    /**
     * @private
     * @param {?} unit
     * @return {?}
     */
    isContent(unit) {
        return !this.hideUnit.includes(unit);
    }
    /**
     * @private
     * @param {?} secondes
     * @return {?}
     */
    updateSimpleCountdown(secondes) {
        /** @type {?} */
        const Seconds = Math.floor((secondes / 1) % 60);
        /** @type {?} */
        const Minutes = Math.floor((secondes / 1 / 60) % 60);
        /** @type {?} */
        const Hours = Math.floor((secondes / (1 * 60 * 60)) % 24);
        /** @type {?} */
        const Day = Math.floor(secondes / (1 * 60 * 60 * 24));
        return {
            day: Day,
            hours: Hours,
            minutes: Minutes,
            seconds: Seconds
        };
    }
    /**
     * @private
     * @return {?}
     */
    getDateNow() {
        this.dateNow = Math.floor(Date.now() / 1000);
    }
    /**
     * @private
     * @param {?} language
     * @return {?}
     */
    setLanguage(language) {
        if (language === 'fr') {
            this.keywords = {
                seconds: 's',
                minutes: 'm',
                hours: 'h',
                day: 'j'
            };
        }
        else if (language === 'de') {
            this.keywords = {
                seconds: 'z',
                minutes: 'm',
                hours: 's',
                day: 't'
            };
        }
        else if (language === 'es' || language === 'pt') {
            this.keywords = {
                seconds: 's',
                minutes: 'm',
                hours: 's',
                day: 'd'
            };
        }
        else if (language === 'cs') {
            this.keywords = {
                seconds: 's',
                minutes: 'm',
                hours: 'h',
                day: 'd'
            };
        }
        else if (language === 'pl') {
            this.keywords = {
                seconds: 's',
                minutes: 'm',
                hours: 'g',
                day: 'd'
            };
        }
        else {
            this.keywords = {
                seconds: 's',
                minutes: 'm',
                hours: 'h',
                day: 'd'
            };
        }
    }
    /**
     * @private
     * @param {?} component
     * @return {?}
     */
    componentDestroyed(component) {
        /** @type {?} */
        const oldNgOnDestroy = component.ngOnDestroy;
        /** @type {?} */
        const destroyed$ = new ReplaySubject(1);
        component.ngOnDestroy = (/**
         * @return {?}
         */
        () => {
            oldNgOnDestroy.apply(component);
            destroyed$.next(undefined);
            destroyed$.complete();
        });
        return destroyed$;
    }
}
NgxSimpleCountdownDirective.decorators = [
    { type: Directive, args: [{
                selector: '[simpleCountdown]'
            },] }
];
/** @nocollapse */
NgxSimpleCountdownDirective.ctorParameters = () => [
    { type: ElementRef }
];
NgxSimpleCountdownDirective.propDecorators = {
    dateTo: [{ type: Input }],
    language: [{ type: Input }],
    reactive: [{ type: Input }],
    endMessage: [{ type: Input }],
    hideUnit: [{ type: Input }],
    styles: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.dateTo;
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.language;
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.reactive;
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.endMessage;
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.hideUnit;
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.styles;
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.keywords;
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.countdownResult;
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.dateNow;
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.totalSecondes;
    /** @type {?} */
    NgxSimpleCountdownDirective.prototype.interval$;
    /**
     * @type {?}
     * @private
     */
    NgxSimpleCountdownDirective.prototype.elementRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXNpbXBsZS1jb3VudGRvd24uZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXNpbXBsZS1jb3VudGRvd24vIiwic291cmNlcyI6WyJsaWIvbmd4LXNpbXBsZS1jb3VudGRvd24uZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQXFCLE1BQU0sZUFBZSxDQUFDO0FBRWhGLE9BQU8sRUFBRSxRQUFRLEVBQWMsYUFBYSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzNELE9BQU8sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBS3hELE1BQU0sT0FBTywyQkFBMkI7Ozs7SUFldEMsWUFBb0IsVUFBc0I7UUFBdEIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQWJqQyxhQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLGFBQVEsR0FBRyxJQUFJLENBQUM7UUFDaEIsZUFBVSxHQUFHLGtCQUFrQixDQUFDO1FBQ2hDLGFBQVEsR0FBRyxFQUFFLENBQUM7UUFDZCxXQUFNLEdBQ2IscUhBQXFILENBQUM7SUFRM0UsQ0FBQzs7OztJQUU5QyxRQUFRO1FBQ04sSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO0lBQzdCLENBQUM7Ozs7SUFFRCxXQUFXLEtBQUksQ0FBQzs7Ozs7SUFFUixtQkFBbUI7UUFDekIsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDaEQsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3RFLElBQUksQ0FBQyxV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QUFPLEVBQUUsR0FBRztnQkFDWixPQUFPLEVBQUUsR0FBRztnQkFDWixLQUFLLEVBQUUsR0FBRztnQkFDVixHQUFHLEVBQUUsR0FBRzthQUNULENBQUM7U0FDSDtJQUNILENBQUM7Ozs7OztJQUVPLGtCQUFrQixDQUFDLFNBQW9COztjQUN2QyxjQUFjLEdBQUcsU0FBUyxDQUFDLFdBQVc7O2NBQ3RDLFVBQVUsR0FBRyxJQUFJLGFBQWEsQ0FBTyxDQUFDLENBQUM7UUFDN0MsU0FBUyxDQUFDLFdBQVc7OztRQUFHLEdBQUcsRUFBRTtZQUMzQixjQUFjLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ2hDLFVBQVUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDM0IsVUFBVSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ3hCLENBQUMsQ0FBQSxDQUFDO1FBQ0YsT0FBTyxVQUFVLENBQUM7SUFDcEIsQ0FBQzs7O1lBeExGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsbUJBQW1CO2FBQzlCOzs7O1lBUDBCLFVBQVU7OztxQkFTbEMsS0FBSzt1QkFDTCxLQUFLO3VCQUNMLEtBQUs7eUJBQ0wsS0FBSzt1QkFDTCxLQUFLO3FCQUNMLEtBQUs7Ozs7SUFMTiw2Q0FBd0I7O0lBQ3hCLCtDQUF5Qjs7SUFDekIsK0NBQXlCOztJQUN6QixpREFBeUM7O0lBQ3pDLCtDQUF1Qjs7SUFDdkIsNkNBQ3dIOztJQUV4SCwrQ0FBNkM7O0lBQzdDLHNEQUFrRDs7SUFDbEQsOENBQXVCOztJQUN2QixvREFBNkI7O0lBQzdCLGdEQUFxQzs7Ozs7SUFFekIsaURBQThCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlyZWN0aXZlLCBJbnB1dCwgRWxlbWVudFJlZiwgT25EZXN0cm95LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCAqIGFzIGZyb21Nb2RlbCBmcm9tICcuL21vZGVscyc7XG5pbXBvcnQgeyBpbnRlcnZhbCwgT2JzZXJ2YWJsZSwgUmVwbGF5U3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFwLCB0YWtlVW50aWwsIGZpbHRlciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW3NpbXBsZUNvdW50ZG93bl0nXG59KVxuZXhwb3J0IGNsYXNzIE5neFNpbXBsZUNvdW50ZG93bkRpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgQElucHV0KCkgZGF0ZVRvOiBudW1iZXI7XG4gIEBJbnB1dCgpIGxhbmd1YWdlID0gJ2VuJztcbiAgQElucHV0KCkgcmVhY3RpdmUgPSB0cnVlO1xuICBASW5wdXQoKSBlbmRNZXNzYWdlID0gJ2NvdW50ZG93biBmaW5pc2gnO1xuICBASW5wdXQoKSBoaWRlVW5pdCA9ICcnO1xuICBASW5wdXQoKSBzdHlsZXMgPVxuICAgICdmb250LXNpemU6MjBweDtjb2xvcjojRkZGO2JhY2tncm91bmQtY29sb3I6IzAwMDtwYWRkaW5nOjEwcHggNXB4O2ZvbnQtd2VpZ2h0OmJvbGQ7bWluLXdpZHRoOjQwcHg7dGV4dC1hbGlnbjpjZW50ZXI7JztcblxuICBwdWJsaWMga2V5d29yZHM6IGZyb21Nb2RlbC5Db3VudGRvd25LZXl3b3JkcztcbiAgcHVibGljIGNvdW50ZG93blJlc3VsdDogZnJvbU1vZGVsLkNvdW50ZG93blJlc3VsdDtcbiAgcHVibGljIGRhdGVOb3c6IG51bWJlcjtcbiAgcHVibGljIHRvdGFsU2Vjb25kZXM6IG51bWJlcjtcbiAgcHVibGljIGludGVydmFsJDogT2JzZXJ2YWJsZTxudW1iZXI+O1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZikge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmdldERhdGVOb3coKTtcbiAgICB0aGlzLnNldExhbmd1YWdlKHRoaXMubGFuZ3VhZ2UpO1xuICAgIHRoaXMuaW5pdFNpbXBsZUNvdW50ZG93bigpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7fVxuXG4gIHByaXZhdGUgaW5pdFNpbXBsZUNvdW50ZG93bigpOiB2b2lkIHtcbiAgICB0aGlzLnRvdGFsU2Vjb25kZXMgPSB0aGlzLmRhdGVUbyAtIHRoaXMuZGF0ZU5vdztcbiAgICB0aGlzLmNvdW50ZG93blJlc3VsdCA9IHRoaXMudXBkYXRlU2ltcGxlQ291bnRkb3duKHRoaXMudG90YWxTZWNvbmRlcyk7XG4gICAgdGhpcy5jcmVhdGVIVE1MKCk7XG5cbiAgICB0aGlzLmludGVydmFsJCA9IGludGVydmFsKDEwMDApLnBpcGUoXG4gICAgICB0YWtlVW50aWwodGhpcy5jb21wb25lbnREZXN0cm95ZWQodGhpcykpLFxuICAgICAgZmlsdGVyKF8gPT4gdGhpcy5yZWFjdGl2ZSAmJiB0aGlzLnRvdGFsU2Vjb25kZXMgPiAwKSxcbiAgICAgIHRhcChfID0+IHRoaXMudG90YWxTZWNvbmRlcy0tKSxcbiAgICAgIHRhcChcbiAgICAgICAgXyA9PlxuICAgICAgICAgICh0aGlzLmNvdW50ZG93blJlc3VsdCA9IHRoaXMudXBkYXRlU2ltcGxlQ291bnRkb3duKFxuICAgICAgICAgICAgdGhpcy50b3RhbFNlY29uZGVzXG4gICAgICAgICAgKSlcbiAgICAgICksXG4gICAgICB0YXAoXyA9PiB0aGlzLmNyZWF0ZUhUTUwoKSlcbiAgICApO1xuXG4gICAgdGhpcy5pbnRlcnZhbCQuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUhUTUwoKTogdm9pZCB7XG4gICAgbGV0IG8gPSAnJztcblxuICAgIGlmICh0aGlzLnRvdGFsU2Vjb25kZXMgPiAwKSB7XG4gICAgICBvID0gJzxkaXYgc3R5bGU9XCJkaXNwbGF5OmZsZXg7XCI+JztcblxuICAgICAgaWYgKHRoaXMuaXNDb250ZW50KCdkJykpIHtcbiAgICAgICAgaWYgKHRoaXMuY291bnRkb3duUmVzdWx0LmRheSA+IDApIHtcbiAgICAgICAgICBvICs9IGA8ZGl2IHN0eWxlPVwiJHt0aGlzLnN0eWxlc31cIj5cbiAgICAgICAgICAke3RoaXMuY291bnRkb3duUmVzdWx0LmRheX0ke3RoaXMua2V5d29yZHMuZGF5fVxuICAgICAgICAgIDwvZGl2PmA7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuaXNDb250ZW50KCdoJykpIHtcbiAgICAgICAgaWYgKHRoaXMuY291bnRkb3duUmVzdWx0LmhvdXJzID4gMCB8fCB0aGlzLmNvdW50ZG93blJlc3VsdC5kYXkgPiAwKSB7XG4gICAgICAgICAgbyArPSBgPGRpdiBzdHlsZT1cIiR7dGhpcy5zdHlsZXN9XCI+XG4gICAgICAgICAgJHt0aGlzLmNvdW50ZG93blJlc3VsdC5ob3Vyc30ke3RoaXMua2V5d29yZHMuaG91cnN9XG4gICAgICAgIDwvZGl2PmA7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuaXNDb250ZW50KCdtJykpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICh0aGlzLmNvdW50ZG93blJlc3VsdC5taW51dGVzID4gMCB8fFxuICAgICAgICAgICAgdGhpcy5jb3VudGRvd25SZXN1bHQuaG91cnMgPiAwIHx8XG4gICAgICAgICAgICB0aGlzLmNvdW50ZG93blJlc3VsdC5kYXkgPiAwKSAmJlxuICAgICAgICAgIHRoaXMucmVhY3RpdmVcbiAgICAgICAgKSB7XG4gICAgICAgICAgbyArPSBgPGRpdiBzdHlsZT1cIiR7dGhpcy5zdHlsZXN9XCI+XG4gICAgICAgICAgJHt0aGlzLmNvdW50ZG93blJlc3VsdC5taW51dGVzfSR7dGhpcy5rZXl3b3Jkcy5taW51dGVzfVxuICAgICAgICA8L2Rpdj5gO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmlzQ29udGVudCgncycpKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICAodGhpcy5jb3VudGRvd25SZXN1bHQuc2Vjb25kcyA+IDAgfHxcbiAgICAgICAgICAgIHRoaXMuY291bnRkb3duUmVzdWx0Lm1pbnV0ZXMgPiAwIHx8XG4gICAgICAgICAgICB0aGlzLmNvdW50ZG93blJlc3VsdC5ob3VycyA+IDAgfHxcbiAgICAgICAgICAgIHRoaXMuY291bnRkb3duUmVzdWx0LmRheSA+IDApICYmXG4gICAgICAgICAgdGhpcy5yZWFjdGl2ZVxuICAgICAgICApIHtcbiAgICAgICAgICBvICs9IGA8ZGl2IHN0eWxlPVwiJHt0aGlzLnN0eWxlc31cIj5cbiAgICAgICAgICAke3RoaXMuY291bnRkb3duUmVzdWx0LnNlY29uZHN9JHt0aGlzLmtleXdvcmRzLnNlY29uZHN9XG4gICAgICAgIDwvZGl2PmA7XG4gICAgICAgIH1cbiAgICAgICAgbyArPSAnPC9kaXY+JztcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMuZW5kTWVzc2FnZSAhPT0gJycpIHtcbiAgICAgICAgbyArPSBgPGRpdiBzdHlsZT1cIiR7dGhpcy5zdHlsZXN9XCI+JHt0aGlzLmVuZE1lc3NhZ2V9PC9kaXY+YDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5pbm5lckhUTUwgPSBvO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0NvbnRlbnQodW5pdDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICF0aGlzLmhpZGVVbml0LmluY2x1ZGVzKHVuaXQpO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVTaW1wbGVDb3VudGRvd24oc2Vjb25kZXM6IG51bWJlcik6IGZyb21Nb2RlbC5Db3VudGRvd25SZXN1bHQge1xuICAgIGNvbnN0IFNlY29uZHMgPSBNYXRoLmZsb29yKChzZWNvbmRlcyAvIDEpICUgNjApO1xuICAgIGNvbnN0IE1pbnV0ZXMgPSBNYXRoLmZsb29yKChzZWNvbmRlcyAvIDEgLyA2MCkgJSA2MCk7XG4gICAgY29uc3QgSG91cnMgPSBNYXRoLmZsb29yKChzZWNvbmRlcyAvICgxICogNjAgKiA2MCkpICUgMjQpO1xuICAgIGNvbnN0IERheSA9IE1hdGguZmxvb3Ioc2Vjb25kZXMgLyAoMSAqIDYwICogNjAgKiAyNCkpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGRheTogRGF5LFxuICAgICAgaG91cnM6IEhvdXJzLFxuICAgICAgbWludXRlczogTWludXRlcyxcbiAgICAgIHNlY29uZHM6IFNlY29uZHNcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXREYXRlTm93KCk6IHZvaWQge1xuICAgIHRoaXMuZGF0ZU5vdyA9IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRMYW5ndWFnZShsYW5ndWFnZTogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKGxhbmd1YWdlID09PSAnZnInKSB7XG4gICAgICB0aGlzLmtleXdvcmRzID0ge1xuICAgICAgICBzZWNvbmRzOiAncycsXG4gICAgICAgIG1pbnV0ZXM6ICdtJyxcbiAgICAgICAgaG91cnM6ICdoJyxcbiAgICAgICAgZGF5OiAnaidcbiAgICAgIH07XG4gICAgfSBlbHNlIGlmIChsYW5ndWFnZSA9PT0gJ2RlJykge1xuICAgICAgdGhpcy5rZXl3b3JkcyA9IHtcbiAgICAgICAgc2Vjb25kczogJ3onLFxuICAgICAgICBtaW51dGVzOiAnbScsXG4gICAgICAgIGhvdXJzOiAncycsXG4gICAgICAgIGRheTogJ3QnXG4gICAgICB9O1xuICAgIH0gZWxzZSBpZiAobGFuZ3VhZ2UgPT09ICdlcycgfHwgbGFuZ3VhZ2UgPT09ICdwdCcpIHtcbiAgICAgIHRoaXMua2V5d29yZHMgPSB7XG4gICAgICAgIHNlY29uZHM6ICdzJyxcbiAgICAgICAgbWludXRlczogJ20nLFxuICAgICAgICBob3VyczogJ3MnLFxuICAgICAgICBkYXk6ICdkJ1xuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKGxhbmd1YWdlID09PSAnY3MnKSB7XG4gICAgICB0aGlzLmtleXdvcmRzID0ge1xuICAgICAgICBzZWNvbmRzOiAncycsXG4gICAgICAgIG1pbnV0ZXM6ICdtJyxcbiAgICAgICAgaG91cnM6ICdoJyxcbiAgICAgICAgZGF5OiAnZCdcbiAgICAgIH07XG4gICAgfSBlbHNlIGlmIChsYW5ndWFnZSA9PT0gJ3BsJykge1xuICAgICAgdGhpcy5rZXl3b3JkcyA9IHtcbiAgICAgICAgc2Vjb25kczogJ3MnLFxuICAgICAgICBtaW51dGVzOiAnbScsXG4gICAgICAgIGhvdXJzOiAnZycsXG4gICAgICAgIGRheTogJ2QnXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmtleXdvcmRzID0ge1xuICAgICAgICBzZWNvbmRzOiAncycsXG4gICAgICAgIG1pbnV0ZXM6ICdtJyxcbiAgICAgICAgaG91cnM6ICdoJyxcbiAgICAgICAgZGF5OiAnZCdcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjb21wb25lbnREZXN0cm95ZWQoY29tcG9uZW50OiBPbkRlc3Ryb3kpIHtcbiAgICBjb25zdCBvbGROZ09uRGVzdHJveSA9IGNvbXBvbmVudC5uZ09uRGVzdHJveTtcbiAgICBjb25zdCBkZXN0cm95ZWQkID0gbmV3IFJlcGxheVN1YmplY3Q8dm9pZD4oMSk7XG4gICAgY29tcG9uZW50Lm5nT25EZXN0cm95ID0gKCkgPT4ge1xuICAgICAgb2xkTmdPbkRlc3Ryb3kuYXBwbHkoY29tcG9uZW50KTtcbiAgICAgIGRlc3Ryb3llZCQubmV4dCh1bmRlZmluZWQpO1xuICAgICAgZGVzdHJveWVkJC5jb21wbGV0ZSgpO1xuICAgIH07XG4gICAgcmV0dXJuIGRlc3Ryb3llZCQ7XG4gIH1cbn1cbiJdfQ==